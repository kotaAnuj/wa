<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Person Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#1a1a2e;color:#eee;overflow:hidden}
#container{position:relative;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center}
#video{display:none}
#canvas{max-width:100%;max-height:100vh;border:2px solid #16213e}
#controls{position:absolute;top:20px;left:20px;z-index:10}
button{background:#0f3460;color:#fff;border:none;padding:12px 24px;margin:5px;cursor:pointer;border-radius:5px;font-size:16px}
button:hover{background:#16213e}
#status{position:absolute;top:20px;right:20px;background:rgba(0,0,0,0.7);padding:15px;border-radius:5px;font-size:14px}
#command{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:rgba(15,52,96,0.9);padding:20px 40px;border-radius:10px;font-size:32px;font-weight:bold;color:#00ff88;min-width:200px;text-align:center;box-shadow:0 0 20px rgba(0,255,136,0.5)}
.path{stroke:#00ff88;stroke-width:3;fill:none;opacity:0.8}
.point{fill:#ff006e;r:4}
</style>
</head>
<body>
<div id="container">
<video id="video" playsinline></video>
<canvas id="canvas"></canvas>
<div id="controls">
<button onclick="startTracking()">Start</button>
<button onclick="stopTracking()">Stop</button>
<button onclick="clearPath()">Clear Path</button>
</div>
<div id="status">
<div>Status: <span id="trackStatus">Ready</span></div>
<div>FPS: <span id="fps">0</span></div>
</div>
<div id="command">READY</div>
</div>

<script>
let video,canvas,ctx,detector,isTracking=false,path=[],lastPos=null,frameCount=0,lastTime=Date.now();
const THRESHOLD=40,COMMAND_DELAY=500;
let lastCommand='READY',lastCommandTime=0;

async function init(){
video=document.getElementById('video');
canvas=document.getElementById('canvas');
ctx=canvas.getContext('2d');
try{
const stream=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});
video.srcObject=stream;
await video.play();
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
const model=poseDetection.SupportedModels.BlazePose;
detector=await poseDetection.createDetector(model,{runtime:'mediapipe',modelType:'lite',solutionPath:'https://cdn.jsdelivr.net/npm/@mediapipe/pose'});
document.getElementById('trackStatus').textContent='Ready';
}catch(e){
console.error('Init error:',e);
document.getElementById('trackStatus').textContent='Error: '+e.message;
}
}

async function startTracking(){
if(!detector){await init()}
isTracking=true;
document.getElementById('trackStatus').textContent='Tracking...';
detectPose();
}

function stopTracking(){
isTracking=false;
document.getElementById('trackStatus').textContent='Stopped';
}

function clearPath(){
path=[];
lastPos=null;
lastCommand='READY';
document.getElementById('command').textContent='READY';
}

async function detectPose(){
if(!isTracking)return;
try{
const poses=await detector.estimatePoses(video);
ctx.drawImage(video,0,0,canvas.width,canvas.height);
if(poses.length>0){
const pose=poses[0];
const nose=pose.keypoints.find(k=>k.name==='nose');
const leftHip=pose.keypoints.find(k=>k.name==='left_hip');
const rightHip=pose.keypoints.find(k=>k.name==='right_hip');
if(nose&&leftHip&&rightHip&&nose.score>0.3){
const centerX=(leftHip.x+rightHip.x)/2;
const centerY=(leftHip.y+rightHip.y)/2;
const currentPos={x:centerX,y:centerY};
if(lastPos){
path.push({x1:lastPos.x,y1:lastPos.y,x2:currentPos.x,y2:currentPos.y});
if(path.length>100)path.shift();
const dx=currentPos.x-lastPos.x;
const dy=currentPos.y-lastPos.y;
const now=Date.now();
if(now-lastCommandTime>COMMAND_DELAY){
let cmd='';
if(Math.abs(dx)>THRESHOLD||Math.abs(dy)>THRESHOLD){
if(Math.abs(dx)>Math.abs(dy)){
cmd=dx>0?'RIGHT':'LEFT';
}else{
cmd=dy>0?'FRONT':'BACK';
}
if(cmd&&cmd!==lastCommand){
lastCommand=cmd;
lastCommandTime=now;
document.getElementById('command').textContent=cmd;
}
}
}
}
lastPos=currentPos;
drawPath();
ctx.beginPath();
ctx.arc(centerX,centerY,8,0,2*Math.PI);
ctx.fillStyle='#ff006e';
ctx.fill();
ctx.strokeStyle='#fff';
ctx.lineWidth=2;
ctx.stroke();
drawSkeleton(pose);
}
}
frameCount++;
const now=Date.now();
if(now-lastTime>1000){
document.getElementById('fps').textContent=frameCount;
frameCount=0;
lastTime=now;
}
}catch(e){
console.error('Detection error:',e);
}
requestAnimationFrame(detectPose);
}

function drawPath(){
if(path.length<2)return;
ctx.strokeStyle='#00ff88';
ctx.lineWidth=3;
ctx.beginPath();
path.forEach((segment,i)=>{
if(i===0)ctx.moveTo(segment.x1,segment.y1);
ctx.lineTo(segment.x2,segment.y2);
});
ctx.stroke();
path.forEach(segment=>{
ctx.beginPath();
ctx.arc(segment.x2,segment.y2,4,0,2*Math.PI);
ctx.fillStyle='#00ff88';
ctx.fill();
});
}

function drawSkeleton(pose){
const connections=[[11,13],[13,15],[12,14],[14,16],[11,12],[5,11],[6,12],[5,6],[5,7],[7,9],[6,8],[8,10],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]];
ctx.strokeStyle='rgba(255,255,255,0.5)';
ctx.lineWidth=2;
connections.forEach(([i,j])=>{
const kp1=pose.keypoints[i];
const kp2=pose.keypoints[j];
if(kp1.score>0.3&&kp2.score>0.3){
ctx.beginPath();
ctx.moveTo(kp1.x,kp1.y);
ctx.lineTo(kp2.x,kp2.y);
ctx.stroke();
}
});
}

window.onload=init;
</script>
</body>
</html>
